<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- The viewport meta tag is essential for responsive design on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulacrum Orbita</title>
  <style>
    :root {
      /* Initially, set via JS */
      --grid-item-min-size: 600px;
    }
    
    /* Style for the clickable telephone text */
    #telephone {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
    }
    
    /* Popover container styling */
    #popover {
      display: none; /* Hidden by default */
      position: absolute;
      background: #fff;
      border: 1px solid #ccc;
      padding: 0.0rem 0.5rem;
      border-radius: 3px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      max-width: 250px;
      z-index: 1000;
    }
    
    /* Base styles for mobile-first design */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: #f9f9f9;
      color: #333;
      transition: padding 0.3s ease;
    }
    
    main {
      padding: 1rem 0;
    }
    
    nav ul {
      list-style: none;
      padding: 0;
      display: flex;
      justify-content: space-around;
    }
    
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    
    @media (min-width: 600px) {
      body {
        max-width: 600px;
        margin: 0 auto;
      }
    }
    
    /* --- Styles for the image grid --- */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(var(--grid-item-min-size), 1fr));
      gap: 1rem;
      margin-top: 2rem;
      transition: gap 0.3s ease;
    }
    
    .grid-item {
      background: #fff;
      padding: 0.5rem;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      transition: border 0.3s ease, padding 0.3s ease;
    }
    
    .grid-item img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* Captions are visible by default */
    .caption {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.7rem;
      color: #555;
      transition: display 0.3s ease;
    }
    
    /* --- Scroll to Top Button --- */
    #scrollToTop {
      position: fixed;
      top: 1rem;
      right: 41rem;
      padding: 0.3rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
      display: none;
      z-index: 2000;
    }
    
    /* --- Zoom Controls Container --- */
    #zoomControls {
      position: fixed;
      bottom: 1rem;
      right: 41rem;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      z-index: 2000;
    }
    
    #zoomControls button {
      padding: 0.3rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    /* --- Styles for max zoom out --- */
    body.maxZoomOut .grid-container {
      gap: 0.2rem; /* Very small gap between images */
    }
    
    body.maxZoomOut .grid-item {
      border: none;
      padding: 0;  /* Remove extra padding */
    }
    
    body.maxZoomOut .caption {
      display: none; /* Hide captions */
    }
  </style>
</head>
<body>
  <header>
    <h1 style="margin-bottom: 0.2rem;">Simulacrum Orbita</h1>
    <p style="font-size: 0.8rem; margin-top: 0.1rem"><i>Nikos Antonio Kourous-Vázquez</i></p>
  </header>

  <main>
    <p>
      Simulacrum Orbita is a never-ending feedback loop between two generative machine learning (AI) models: one generates images, while the other describes them. Like the game “<span id="telephone">telephone</span>”, a message is passed along between them, becoming slowly distorted over time.
    </p>

    <p>
      First, an image is generated using a prompt – such as ‘a dog running in a field’. This newly created image is then passed along to the machine learning program able to ‘see’ and describe images. Rather than accurately describing that image as ‘a dog running in a field’, however, this model might describe it as ‘a bear running in a forest’ instead. This new description is then used as the prompt for the next image, and so on.
    </p>
    
    <p>
      Overtime, random deviations, either in the generated images or in their generated descriptions, transform the content, nature, and trajectory of the image sequence. Upon each subsequent update, each monitor displays, from left to right, a new image created from the generated description of the image before it. Sometimes, the imagery shifts rapidly between different objects, people, and places as they struggle to communicate and understand one another. Other times, the models find themselves lost in forest paths or city streets, or in fields of grass.
    </p>
    
    <p>
      Simulacrum Orbita is powered by the captioning machine learning model 
      <a href="https://arxiv.org/abs/2201.12086" target="_blank" rel="noopener noreferrer">BLIP</a> 
      and 
      <a href="https://github.com/crowsonkb/v-diffusion-pytorch" target="_blank" rel="noopener noreferrer">CC12M V Objective Diffusion</a>.
    </p>

    <p style="text-align: center;">_____________________________________________</p>
    
    <img src="orbitis diagram final.png" alt="Diagram" style="display: block; margin: 1em 0; width: 300px; height: auto;">

    <br>
    <header>
      <h2><i>example run </i></h2>
    </header>
    <p>Below are the images from a one hour uninterrupted run. Zoom in to see the captions, or zoom out to see the overall evolution of imagery!</p>
    
    <!-- Popover for the telephone text -->
    <div id="popover">
      <p>
        Also called 'broken telephone' or 'chinese whispers,' although this term connotes non-western language and culture to ideas of confusion and incomprehensibility.
      </p>
    </div>

    <!-- Image grid container -->
    <div class="grid-container" id="imageGrid">
      <!-- Grid items will be generated here from JSON -->
    </div>
  </main>

  <!-- Scroll To Top Button -->
  <button id="scrollToTop">Top</button>

  <!-- Zoom Controls -->
  <div id="zoomControls">
    <button id="zoomIn">zoom in!</button>
    <button id="zoomOut">zoom out!</button>
  </div>

  <script>
    // --- Popover functionality for "telephone" ---
    const telephone = document.getElementById('telephone');
    const popover = document.getElementById('popover');

    telephone.addEventListener('click', (e) => {
      const rect = telephone.getBoundingClientRect();
      popover.style.top = (rect.bottom + window.scrollY) + 'px';
      popover.style.left = (rect.left + window.scrollX) + 'px';
      popover.style.display = 'block';
      e.stopPropagation();
    });

    document.addEventListener('click', (event) => {
      if (!popover.contains(event.target) && event.target !== telephone) {
        popover.style.display = 'none';
      }
    });

    // --- Image Grid with Captions Visible by Default ---
    function createGridItem(imageData) {
      const gridItem = document.createElement('div');
      gridItem.className = 'grid-item';
      
      const img = document.createElement('img');
      img.src = imageData.filename;
      img.alt = imageData.filename.split('\\').pop().split('/').pop();
      
      const captionDiv = document.createElement('div');
      captionDiv.className = 'caption';
      captionDiv.textContent = imageData.caption;
      
      gridItem.appendChild(img);
      gridItem.appendChild(captionDiv);
      
      return gridItem;
    }
    
    fetch('image_captions.json')
      .then(response => response.json())
      .then(data => {
        data.sort((a, b) => {
          const regex = /duo(\d+)\.png$/;
          const matchA = a.filename.match(regex);
          const matchB = b.filename.match(regex);
          if (matchA && matchB) {
            const numA = parseInt(matchA[1], 10);
            const numB = parseInt(matchB[1], 10);
            return numA - numB;
          }
          return a.filename.localeCompare(b.filename);
        });
        
        const gridContainer = document.getElementById('imageGrid');
        data.forEach(imageData => {
          const gridItem = createGridItem(imageData);
          gridContainer.appendChild(gridItem);
        });
      })
      .catch(error => console.error('Error loading images:', error));

    // --- Scroll Behavior for "Scroll to Top" Button ---
    const scrollToTopButton = document.getElementById('scrollToTop');
    const fixedThreshold = 200;
    window.addEventListener('scroll', () => {
      scrollToTopButton.style.display = window.scrollY > fixedThreshold ? 'block' : 'none';
    });
    scrollToTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });

    // --- Zoom Controls ---
    const zoomInButton = document.getElementById('zoomIn');
    const zoomOutButton = document.getElementById('zoomOut');
    
    // Define four zoom levels:
    // Level 0: 1 image per row (max zoom in) => 600px
    // Level 1: ~3 images per row           => 200px
    // Level 2: ~5 images per row           => 120px
    // Level 3: ~9 images per row (max zoom out) => 66.67px
    const zoomLevels = ["600px", "200px", "120px", "66.67px"];
    // Start at maximum zoom out (level 3)
    let currentZoomLevel = zoomLevels.length - 1;
    
    function updateGridZoom() {
      document.documentElement.style.setProperty('--grid-item-min-size', zoomLevels[currentZoomLevel]);
      
      // Toggle the "maxZoomOut" class on body at level 3
      if (currentZoomLevel === zoomLevels.length - 1) {
        document.body.classList.add('maxZoomOut');
      } else {
        document.body.classList.remove('maxZoomOut');
      }
      
      // Show/hide buttons accordingly
      zoomOutButton.style.display = (currentZoomLevel === zoomLevels.length - 1) ? "none" : "block";
      zoomInButton.style.display = (currentZoomLevel === 0) ? "none" : "block";
    }
    
    zoomInButton.addEventListener('click', () => {
      if (currentZoomLevel > 0) {
        currentZoomLevel--;
        updateGridZoom();
      }
    });
    
    zoomOutButton.addEventListener('click', () => {
      if (currentZoomLevel < zoomLevels.length - 1) {
        currentZoomLevel++;
        updateGridZoom();
      }
    });
    
    // Initialize zoom level on page load
    updateGridZoom();
  </script>

  <footer>
    <p>&copy; 2025 Nikos Antonio Kourous-Vázquez</p>
  </footer>
</body>
</html>
